<project default="package-java" basedir=".">

  <import file="../com.oaklandsw.build/build.common.xml"/>

  <!-- =================================================================== -->
  <!-- Initialization target                                               -->
  <!-- =================================================================== -->
  <target name="init" depends="common-init">

    <!-- <property name="build.compiler" value="jikes"/> -->

  	<path id="compile.classpath">
      <fileset dir="${basedir}/../com.oaklandsw.${package.name}.jars">
        <include name="*.jar" />
      </fileset>
  	  <dirset dir="${basedir}/../com.oaklandsw.util/bin"/>
    </path>

  </target>


  <!-- =================================================================== -->
  <!-- Creates the API documentation                                       -->
  <!-- =================================================================== -->
  <target name="javadoc" depends="prepare">
    <mkdir dir="${javadocs.dir}"/>
    <javadoc sourcepath="${src.dir}"
             destdir="${javadocs.dir}"
             access="public"
             windowtitle="Oakland Software HTTP Client API"
             doctitle="Oakland Software HTTP Client"
             bottom="Copyright &#169; 2002-2006 Oakland Software Incorporated. All Rights Reserved."
    >
      <classpath refid="compile.classpath"/>
      <fileset dir="${src.dir}" defaultexcludes="yes">
        <!-- MAKE SURE TO update the build.http.xml file -->
        <include name="com/oaklandsw/http/HttpURLConnection.java" />
        <include name="com/oaklandsw/http/HttpConnectionManager.java" />
        <include name="com/oaklandsw/http/URIException.java" />
        <include name="com/oaklandsw/http/HttpException.java" />
        <include name="com/oaklandsw/http/HttpTimeoutException.java" />
        <include name="com/oaklandsw/http/HttpUserAgent.java" />
        <include name="com/oaklandsw/http/Credential.java" />
        <include name="com/oaklandsw/http/UserCredential.java" />
        <include name="com/oaklandsw/http/NtlmCredential.java" />
        <include name="com/oaklandsw/http/HostnameVerifier.java" />
      </fileset>
      </javadoc>
  </target>


  <!-- =================================================================== -->
  <!-- Creates the class package - overrides common                        -->
  <!-- =================================================================== -->
  <target name="package-java" depends="compile-java">
    <jar jarfile="${package.name}.jar">
      <fileset dir="${bin.dir}"/>
      <fileset dir="../com.oaklandsw.util/bin"/>
      <zipfileset src="../com.oaklandsw.http.jars/jakarta-regexp-1.3.jar"/>
      <manifest>
        <section name="org/apache/regexp/">
          <attribute name="Sealed" value="true"/>
        </section>
      </manifest>
    </jar>

  </target>

  <!-- =================================================================== -->
  <!-- Creates the distribution - HTTP                                     -->
  <!-- =================================================================== -->
  <target name="dist" depends="javadoc, obf-java">
    <mkdir dir="${dist.dir}"/>

    <delete> 
      <fileset dir="${dist.dir}"/>
    </delete> 

    <!-- normal -->
    <zip
      zipfile="${dist.dir}/${dist.zip.name}.zip" 
      includes="**">
       <fileset dir="${basedir}">
         <include name="README"/>
         <include name="*LICENSE"/>
         <exclude name="SOURCE_LICENSE"/>
         <include name="*.sample"/>
         <include name="${package.name}.jar"/>
       </fileset>
       <fileset dir="../com.oaklandsw.http.tests/src/" >
         <include name="HttpGetSample.java" />
       </fileset>
       <zipfileset dir="${javadocs.dir}" prefix="javadocs"/>
    </zip>

    <!-- obfuscated -->
    <zip
      zipfile="${dist.dir}/${dist.zip.name}Ob.zip" 
      includes="**">
       <zipfileset src="${dist.dir}/${dist.zip.name}.zip">
         <exclude name="${package.name}.jar"/>
       </zipfileset>
       <zipfileset dir="." includes="${package.name}Ob.jar" fullpath="${package.name}.jar"/>
    </zip>

    <!-- source -->
    <zip
      zipfile="${dist.dir}/${dist.zip.name}Src.zip" 
      includes="**">
        <zipfileset dir="${src.dir}" prefix="src"/>
        <zipfileset dir="../com.oaklandsw.util/src" prefix="src"/>
       <fileset dir="${basedir}">
        <include name="build.http.xml"/>
        <include name="SOURCE_LICENSE"/>
       </fileset>
    </zip>

  </target>



</project>
