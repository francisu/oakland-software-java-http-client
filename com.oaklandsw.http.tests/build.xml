<project default="package-java" basedir=".">

  <import file="../com.oaklandsw.build/build.common.xml"/>

  <!-- =================================================================== -->
  <!-- Initialization target                                               -->
  <!-- =================================================================== -->
  <target name="init" depends="common-init">

  	<path id="compile.classpath">
      <fileset dir="${basedir}/../com.oaklandsw.http.jars">
        <include name="*.jar" />
      </fileset>
      <fileset dir="${basedir}/../com.oaklandsw.http.tests.jars">
        <include name="*.jar" />
      </fileset>
        <fileset dir="${basedir}/../com.oaklandsw.util.jars">
          <include name="*.jar" />
        </fileset>
  	  <fileset file="../com.oaklandsw.build/junit.jar"/>	
     	  <dirset dir="${basedir}/../com.oaklandsw.http/bin"/>
     	  <dirset dir="${basedir}/../com.oaklandsw.http.tests/bin"/>
     	  <dirset dir="${basedir}/../com.oaklandsw.util/bin"/>
     	  <dirset dir="${basedir}/../com.oaklandsw.build/bin"/>
    </path>

  </target>

	  <!-- =================================================================== -->
	  <!-- Creates the package - overrides common                        -->
	  <!-- =================================================================== -->
	  <target name="package-java" depends="compile-java">
	    <jar jarfile="${package.name}tests.jar">
	      <fileset dir="${bin.dir}"/>
          <fileset dir="../com.oaklandsw.build/bin"/>
	    </jar>

	  </target>

	<target name="create-versions"/>

	
	  <!-- =================================================================== -->
	  <!-- HTTP Tomcat test WAR file                                           -->
	  <!-- =================================================================== -->
	  <target name="http-war"
	          depends="init, compile-java"
	          description="Build all the files and package them into a WAR file">
	    <war warfile="oaklandsw.war"
	         webxml="webapp/http/conf/web.xml">
	      <webinf dir="webapp/http/conf">
	        <include name="**"/>
	        <exclude name="web.xml"/>
	        <exclude name="classes/**"/>
	        <exclude name="lib/**"/>
	      </webinf>
	      <classes dir="bin">
	        <include name="**"/>
	      </classes>
	    </war>
	  </target>
	  <!-- =================================================================== -->
	  <!-- Junit tests                        -->
	  <!-- =================================================================== -->
		<target name="junit" depends="compile-java">
			<junit printsummary="on" fork="on">
				<jvmarg value="-Dlog4j.configuration=../com.oaklandsw.build/src/logprops/ljp.none"/>
				<jvmarg value="-Djava.util.logging.config.file=../com.oaklandsw.build/src/logprops/ljp.none"/>
				<sysproperty key="OAKLANDSW_ROOT" value=".."/>
				<sysproperty key="oaklandsw.localhost" value="repoman"/>
				<sysproperty key="oaklandsw.errorhost" value="berlioz"/>
				<sysproperty key="java.net.preferIPv4Stack" value="true"/>
				<classpath refid="compile.classpath"/>
				<formatter type="plain" usefile="false"/>
				<!--batchtest>
					<fileset dir="bin/com/oaklandsw/http" includes="webapp/Test*.class"/>
				</batchtest-->
				<!--test name="com.oaklandsw.http.TestAll"/-->
				<test name="com.oaklandsw.http.TestAll"/>
			</junit>
		</target>
</project>
